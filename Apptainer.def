Bootstrap: docker
From: python:3.10
Stage: spython-base

%files
    . /health-ai-framework

%post
    # update ubuntu
    apt-get update && apt-get upgrade -y

    # install dependencies
    apt-get install -y ffmpeg

    # install PDM (Python Dependency Manager)
    pip install pdm

    # set working directory
    mkdir -p /health-ai-framework
    cd /health-ai-framework

    # set environment variable to indicate the code is running inside a Docker container
    export IS_IN_DOCKER="true"

    # install project dependencies using PDM
    pdm install

%environment
    export IS_IN_DOCKER="true"

%runscript
    cd /health-ai-framework
    exec pdm run

%startscript
    cd /health-ai-framework
    exec pdm run

# Build the image
# sudo apptainer build health-ai-framework.sif Singularity
